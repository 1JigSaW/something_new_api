<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Something New - Admin Panel</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            background: #f5f5f7;
        }
        .header {
            background: #8b5cf6;
            color: white;
            padding: 20px;
            border-radius: 12px;
            margin-bottom: 20px;
        }
        .section {
            background: white;
            padding: 20px;
            border-radius: 12px;
            margin-bottom: 20px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        .challenge-card {
            border: 1px solid #e5e7eb;
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 10px;
            background: #f9fafb;
        }
        .challenge-title {
            font-weight: 600;
            color: #1f2937;
            margin-bottom: 5px;
        }
        .challenge-meta {
            font-size: 14px;
            color: #6b7280;
            margin-bottom: 5px;
        }
        .challenge-desc {
            color: #374151;
            margin-bottom: 10px;
        }
        .tag {
            display: inline-block;
            background: #8b5cf6;
            color: white;
            padding: 2px 8px;
            border-radius: 12px;
            font-size: 12px;
            margin-right: 5px;
        }
        .size-small { background: #10b981; }
        .size-medium { background: #f59e0b; }
        .size-large { background: #ef4444; }
        .premium { background: #8b5cf6; }
        .stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-bottom: 20px;
        }
        .stat-card {
            background: white;
            padding: 20px;
            border-radius: 12px;
            text-align: center;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        .stat-number {
            font-size: 2em;
            font-weight: bold;
            color: #8b5cf6;
        }
        .stat-label {
            color: #6b7280;
            margin-top: 5px;
        }
        button {
            background: #8b5cf6;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 8px;
            cursor: pointer;
            margin: 5px;
        }
        button:hover {
            background: #7c3aed;
        }
        .loading {
            text-align: center;
            color: #6b7280;
            padding: 20px;
        }
    </style>
</head>
<body>
    <div class="header">
        <h1>üß© Something New - Admin Panel</h1>
        <p>–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —á–µ–ª–ª–µ–Ω–¥–∂–∞–º–∏ –∏ –º–µ—Ç–∞–¥–∞–Ω–Ω—ã–º–∏</p>
    </div>

    <div class="stats" id="stats">
        <div class="stat-card">
            <div class="stat-number" id="total-challenges">-</div>
            <div class="stat-label">–í—Å–µ–≥–æ —á–µ–ª–ª–µ–Ω–¥–∂–µ–π</div>
        </div>
        <div class="stat-card">
            <div class="stat-number" id="total-categories">-</div>
            <div class="stat-label">–ö–∞—Ç–µ–≥–æ—Ä–∏–π</div>
        </div>
        <div class="stat-card">
            <div class="stat-number" id="premium-challenges">-</div>
            <div class="stat-label">Premium —á–µ–ª–ª–µ–Ω–¥–∂–µ–π</div>
        </div>
        <div class="stat-card">
            <div class="stat-number" id="free-challenges">-</div>
            <div class="stat-label">–ë–µ—Å–ø–ª–∞—Ç–Ω—ã—Ö</div>
        </div>
    </div>

    <div class="section">
        <h2>üìä –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø–æ —Ä–∞–∑–º–µ—Ä–∞–º</h2>
        <div id="size-stats" class="loading">–ó–∞–≥—Ä—É–∑–∫–∞...</div>
    </div>

    <div class="section">
        <h2>üéØ –ü–æ—Å–ª–µ–¥–Ω–∏–µ —á–µ–ª–ª–µ–Ω–¥–∂–∏</h2>
        <button onclick="loadChallenges()">–û–±–Ω–æ–≤–∏—Ç—å</button>
        <div id="challenges" class="loading">–ó–∞–≥—Ä—É–∑–∫–∞...</div>
    </div>

    <div class="section">
        <h2>üè∑Ô∏è –ú–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ</h2>
        <button onclick="loadMeta()">–û–±–Ω–æ–≤–∏—Ç—å</button>
        <div id="meta" class="loading">–ó–∞–≥—Ä—É–∑–∫–∞...</div>
    </div>

    <script>
        const API_BASE = 'http://localhost:8001/api';

        async function fetchData(url) {
            try {
                const response = await fetch(url);
                if (!response.ok) throw new Error(`HTTP ${response.status}`);
                return await response.json();
            } catch (error) {
                console.error('Error fetching data:', error);
                return null;
            }
        }

        async function loadStats() {
            const challenges = await fetchData(`${API_BASE}/admin/challenges?limit=1000`);
            if (!challenges) return;

            const total = challenges.length;
            const premium = challenges.filter(c => c.is_premium_only).length;
            const free = total - premium;

            document.getElementById('total-challenges').textContent = total;
            document.getElementById('premium-challenges').textContent = premium;
            document.getElementById('free-challenges').textContent = free;

            // –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø–æ —Ä–∞–∑–º–µ—Ä–∞–º
            const sizeStats = challenges.reduce((acc, c) => {
                acc[c.size] = (acc[c.size] || 0) + 1;
                return acc;
            }, {});

            const sizeStatsHtml = Object.entries(sizeStats)
                .map(([size, count]) => `<span class="tag size-${size}">${size}: ${count}</span>`)
                .join(' ');

            document.getElementById('size-stats').innerHTML = sizeStatsHtml;
        }

        async function loadChallenges() {
            document.getElementById('challenges').innerHTML = '<div class="loading">–ó–∞–≥—Ä—É–∑–∫–∞...</div>';
            
            const challenges = await fetchData(`${API_BASE}/admin/challenges?limit=10`);
            if (!challenges) {
                document.getElementById('challenges').innerHTML = '<div class="loading">–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏</div>';
                return;
            }

            const challengesHtml = challenges.map(challenge => `
                <div class="challenge-card">
                    <div class="challenge-title">${challenge.title}</div>
                    <div class="challenge-meta">
                        <span class="tag">${challenge.category}</span>
                        <span class="tag size-${challenge.size}">${challenge.size}</span>
                        ${challenge.is_premium_only ? '<span class="tag premium">Premium</span>' : ''}
                        ${challenge.estimated_duration_min ? `<span class="tag">${challenge.estimated_duration_min} –º–∏–Ω</span>` : ''}
                    </div>
                    <div class="challenge-desc">${challenge.short_description}</div>
                    <div>
                        ${challenge.tags.split(',').map(tag => `<span class="tag">${tag.trim()}</span>`).join(' ')}
                    </div>
                </div>
            `).join('');

            document.getElementById('challenges').innerHTML = challengesHtml;
        }

        async function loadMeta() {
            document.getElementById('meta').innerHTML = '<div class="loading">–ó–∞–≥—Ä—É–∑–∫–∞...</div>';
            
            const meta = await fetchData(`${API_BASE}/admin/meta`);
            if (!meta) {
                document.getElementById('meta').innerHTML = '<div class="loading">–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏</div>';
                return;
            }

            document.getElementById('total-categories').textContent = meta.categories.length;

            const metaHtml = `
                <h3>–ö–∞—Ç–µ–≥–æ—Ä–∏–∏ (${meta.categories.length})</h3>
                <p>${meta.categories.map(c => `<span class="tag">${c.name}</span>`).join(' ')}</p>
                
                <h3>–†–∞–∑–º–µ—Ä—ã (${meta.sizes.length})</h3>
                <p>${meta.sizes.map(s => `<span class="tag size-${s.name}">${s.name}</span>`).join(' ')}</p>
                
                <h3>–¢–µ–≥–∏ (${meta.tags.length})</h3>
                <p>${meta.tags.map(t => `<span class="tag">${t.name}</span>`).join(' ')}</p>
            `;

            document.getElementById('meta').innerHTML = metaHtml;
        }

        // –ó–∞–≥—Ä—É–∂–∞–µ–º –¥–∞–Ω–Ω—ã–µ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
        window.onload = function() {
            loadStats();
            loadChallenges();
            loadMeta();
        };
    </script>
</body>
</html>
